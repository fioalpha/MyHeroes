name: CI
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup SDK 1.17
        uses: actions/setup-java@v3
        with: 
          java-version: 17
          distribution: 'adopt'
        
      - name: Setuop Android SDK
        uses: android-actions/setup-android@v2
        
#      - name: Unit test
#        run: ./gradlew coverAllVariants
#
#      - name: Merge report
#        run: ./gradlew allDebugCoverage
#
#      - name: Build debug
#        run: ./gradlew --no-daemon build

      - name: Run Android tests on Firebase Test Lab
        uses: asadmansr/Firebase-Test-Lab-Action@v1.0
#        with:
#          arg-spec: 'android-device.yml:android-pixel-4'
        env:
          SERVICE_ACCOUNT: ${{ secrets.FIREBASE_AUTH }}
#
#      - name: Download Android test APK
#        uses: actions/download-artifact@v1
#        with:
#          name: app-debug-androidTest
#
#      - name: Login to Google Cloud
#        uses: GoogleCloudPlatform/github-actions/setup-gcloud
#        with:
#          version: '270.0.0'
#          service_account_key: ${{ secrets.GCLOUD_SERVICE_KEY }}
#
#      - name: Set current project
#        run: gcloud config set project heroes-ef5c5

#      - name: Run Instrumentation Tests in Firebase Test Lab
#        run: gcloud firebase test android run --type instrumentation --app app-debug/app-debug.apk --test app-debug-androidTest/app-debug-androidTest.apk --device model=Pixel2,version=28,locale=pl,orientation=portrait
